<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Java EE 7 Hands-on Lab</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
</head>
<body class="article">
<div id="header">
<h1>Java EE 7 Hands-on Lab</h1>
<span id="author" class="author">Arun Gupta</span><br>
<span id="revnumber">version 2.0,</span>
<span id="revdate">Dec 3, 2013</span>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_software_requirement">1.1. Software Requirement</a></li>
</ul>
</li>
<li><a href="#_problem_statement">2. Problem Statement</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_lab_flow">2.1. Lab Flow</a></li>
<li><a href="#_estimated_time">2.2. Estimated Time</a></li>
</ul>
</li>
<li><a href="#walk-through">3. Walk-through of Sample Application</a></li>
<li><a href="#websocket">4. Chat Room (Java API for WebSocket)</a></li>
<li><a href="#batch">5. Ticket Sales (Batch Applications for the Java Platform)</a></li>
<li><a href="#jaxrs">6. View and Delete Movie (Java API for RESTful Web Services)</a></li>
<li><a href="#json">7. Add Movie (Java API for JSON Processing)</a></li>
<li><a href="#jms">8. Movie Points (Java Message Service)</a></li>
<li><a href="#jsf">9. Show Booking (JavaServer Faces)</a></li>
<li><a href="#_conclusion">10. Conclusion</a></li>
<li><a href="#_troubleshooting">11. Troubleshooting</a></li>
<li><a href="#_acknowledgements">12. Acknowledgements</a></li>
<li><a href="#_completed_solutions">13. Completed Solutions</a></li>
<li><a href="#_todo">14. TODO</a></li>
<li><a href="#_revision_history">15. Revision History</a></li>
<li><a href="#_appendix">16. Appendix A: Appendix</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#appendix-glassfish4-netbeans">16.1. Configure GlassFish 4 in NetBeans IDE</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java EE 7 platform continues the ease of development push that
characterized prior releases by bringing further simplification to
enterprise development. It adds new and important APIs such as the REST
client API in JAX-RS 2.0 and the long awaited Batch Processing API. Java
Message Service 2.0 has undergone an extreme makeover to align with the
improvements in the Java language. There are plenty of improvements to
several other components. Newer web standards like HTML 5, WebSocket,
and JSON processing are embraced to build modern web applications.</p>
</div>
<div class="paragraph">
<p>This hands-on lab will build a typical 3-tier end-to-end application
using the following Java EE 7 technologies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java API for WebSocket 1.0 (JSR 356)</p>
</li>
<li>
<p>Batch Applications for the Java Platform 1.0 (JSR 352)</p>
</li>
<li>
<p>Java API for JSON Processing 1.0 (JSR 353)</p>
</li>
<li>
<p>Java API for RESTful Web Services 2.0 (JSR 339)</p>
</li>
<li>
<p>Java Message Service 2.0 (JSR 343)</p>
</li>
<li>
<p>Java Persistence API 2.1 (JSR 338)</p>
</li>
<li>
<p>JavaServer Faces 2.2 (JSR 344)</p>
</li>
<li>
<p>Contexts and Dependency Injection 1.1 (JSR 346)</p>
</li>
<li>
<p>Bean Validation 1.1 (JSR 349)</p>
</li>
<li>
<p>Java Transaction API 1.2 (JSR 907)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Together these APIs will allow you to be more productive by simplifying enterprise development.</p>
</div>
<div class="paragraph">
<p>The latest version of this document can be downloaded from <a href="https://github.com/javaee-samples/javaee7-hol/blob/master/docs/asciidoc/javaee7-hol.html">javaee7-hol.html</a>.</p>
</div>
<div class="sect2">
<h3 id="_software_requirement">1.1. Software Requirement</h3>
<div class="paragraph">
<p>The following software needs to be downloaded and installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 7 from
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</p>
</li>
<li>
<p>NetBeans 7.4 or higher "All" or "Java EE" version from
<a href="http://netbeans.org/downloads/">http://netbeans.org/downloads/</a>. A
preview of the downloads page is shown and highlights the exact
"Download" button to be clicked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/1.1-netbeans-download.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>GlassFish 4 comes pre-bundled with NetBeans 7.4+ and does not need to be downloaded explicitly. But if you want to download GlassFish 4 then can do so from <a href="http://glassfish.org/">glassfish.org</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you have downloaded GlassFish 4 separately or using a pre-installed version of GlassFish 4, then configure it in NetBeans IDE following the instructions in <a href="#appendix-glassfish4-netbeans">Configure GlassFish 4 in NetBeans IDE</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_statement">2. Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hands-on lab builds a typical 3-tier Java EE 7 Web application that
allows customers to view the show timings for a movie in a 7-theater
Cineplex and make reservations. Users can add new movies and delete
existing movies. Customers can discuss the movie in a chat room. Total
sales from each showing are calculated at the end of the day. Customers
also accrue points for watching movies.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2.0-problem-statement.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This figure shows the key components of the application. The User
Interface initiates all the flows in the application. Show Booking,
Add/Delete Movie and Ticket Sales interact with the database; Movie
Points may interact with the database, however, this is out of scope for
this application; and Chat Room does not interact with the database.</p>
</div>
<div class="paragraph">
<p>The different functions of the application, as detailed above, utilize
various Java technologies and web standards in their implementation. The
following figure shows how Java EE technologies are used in different
flows.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2.0-technologies.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The table below details the components and the selected technology used
in its’ implementation.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:80%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flow</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Written entirely in <em>JavaServer Faces</em> (JSF)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chat Room</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilizes client-side JavaScript and JSON to communicate with a <em>WebSocket</em> endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ticket Sales</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>Batch Applications for the Java Platform</em> to calculate the total
sales and persist to the database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add/Delete Movie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implemented using RESTful Web Services. JSON is used as on-the-wire data format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Movie Points</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses <em>Java Message Service</em> (JMS) to update and obtain loyalty reward
points; an optional implementation using database technology may be
performed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show Booking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses lightweight <em>Enterprise JavaBeans</em> to communicate with the database
using Java Persistence API</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>This document is not a comprehensive tutorial of Java EE. The attendees
are expected to know the basic Java EE concepts such as EJB, JPA,
JAX-RS, and CDI. The <a href="http://docs.oracle.com/javaee/7/tutorial/doc/">Java
EE 7 Tutorial</a> is a good place to learn all these concepts. However
enough explanation is provided in this guide to get you started with the
application.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This is a sample application and the code may not be
following the best practices to prevent SQL injection, cross-side
scripting attacks, escaping parameters, and other similar features
expected of a robust enterprise application. This is intentional such as
to stay focused on explaining the technology. It is highly recommended
to make sure that the code copied from this sample application is
updated to meet those requirements.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_lab_flow">2.1. Lab Flow</h3>
<div class="paragraph">
<p>The attendees will start with an existing maven application and by
following the instructions and guidance provided by this lab they will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read existing source code to gain an understanding of the structure of
the application and use of the selected platform technologies.</p>
</li>
<li>
<p>Add new and update existing code with provided fragments in order to
demonstrate usage of different technology stacks in the Java EE 7
platform.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While you are copy/pasting the code from this document into NetBeans,
here are couple of tips that will be really useful and make your
experience enjoyable!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NetBeans provides capability to neatly format the source code
following conventions. This can be done for any type of source code,
whether its XML or Java or something else. It is highly recommended to
use this functionality after the code is copy/pasted from this document
to the editor. This keeps the code legible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This functionality can be accessed by right-clicking in the editor pane
and selecting “Format” as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2.1-format.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This functionality is also accessible using the following keyboard
shortcuts:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:50%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shortcut</th>
<th class="tableblock halign-left valign-top">Operating System</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl + Shift + F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alt + Shift + F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alt + Shift + F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
</tbody>
</table>

<div class="ulist">
<ul>
<li>
<p>Copy/pasting the Java code from this document in NetBeans editor does
not auto-import the classes. This is required to be done manually in
order for the classes to compile. This can be fixed for each missing
import statement by clicking on the yellow bulb shown in the side bar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2.1-server-endpoint.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Alternatively all the imports can be resolved by right-clicking on the
editor pane and selecting "Fix Imports" as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2.1-fix-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This functionality is also accessible using the following keyboard
shortcuts:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:50%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Shortcut</th>
<th class="tableblock halign-left valign-top">Operating System</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command + Shift + I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl + Shift + I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ctrl + Shift + I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The defaults may work in most of the cases. Choices are shown in case a
class is available to import from multiple packages. If multiple
packages are available then specific packages to import from are clearly
marked in the document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_estimated_time">2.2. Estimated Time</h3>
<div class="paragraph">
<p>Following the complete instructions in this document can take any where
from three to five hours. The wide time range accommodates for learning
the new technologies, finding your way in NetBeans, copy/pasting the
code, and debugging the errors.</p>
</div>
<div class="paragraph">
<p>The recommended flow is where you follow through the instructions in all
sections in the listed sequence. Alternatively, you may like to cover
section <a href="#walk-through">Walk-through of Sample Application</a> through <a href="#jsf">Show Booking (JavaServer Faces)</a> in an order of your choice, based upon your
interest and preference of the technology. However section &lt;jaxrs&gt; is a
pre-requisite for <a href="#json">Add Movie (Java API for JSON Processing)</a>.</p>
</div>
<div class="paragraph">
<p>Here is an approximate time estimate for each section:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:66%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Section Title</th>
<th class="tableblock halign-left valign-top">Estimated Time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#walk-through">Walk-through of Sample Application</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 - 30 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#websocket">Chat Room (Java API for WebSocket)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#batch">Ticket Sales (Batch Applications for the Java Platform)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jaxrs">View and Delete Movie (Java API for RESTful Web Services)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#json">Add Movie (Java API for JSON Processing)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jms">Movie Points (Java Message Service)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jsf">Show Booking (JavaServer Faces)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 - 45 mins</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>The listed time for each section is only an estimate and by no means
restrict you within that. These sections have been completed in much
shorter time, and you can do it too!</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The listed time for each section also allows you to create a custom
version of the lab depending upon your target audience and available
time.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="walk-through">3. Walk-through of Sample Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: This section will download the sample application to be used
in this hands-on lab. A walk-through of the application will be
performed to provide an understanding of the application architecture.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 15-30 mins</p>
</div>
<div class="paragraph">
<p><strong>3.1</strong> Download the sample application from
<a href="https://github.com/javaee-samples/javaee7-hol/blob/master/starting-template/movieplex7-starting-template.zip?raw=true">movieplex7-starting-template.zip</a>
and unzip. This will create a "movieplex7" directory and unzips all the
content there.</p>
</div>
<div class="paragraph">
<p><strong>3.2</strong> In NetBeans IDE, select "File", "Open Project…", select the
unzipped directory, and click on "Open Project". The project structure
is shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.2-project-structure.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>3.3</strong> Maven Coordinates: Expand "Project Files" and double click on
"pom.xml". In the "pom.xml", the Java EE 7 API is specified as a
<code>&lt;dependency&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;javax&lt;/groupId&gt;
        &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;
        &lt;version&gt;7.0&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will ensure that Java EE 7 APIs are retrieved from the central
Maven repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Java EE 6 platform introduced the notion of "profiles". A profile is
a configuration of the Java EE platform targeted at a specific class of
applications. All Java EE profiles share a set of common features, such
as naming and resource injection, packaging rules, security
requirements, etc. A profile may contain a proper subset or superset of
the technologies contained in the platform.</p>
</div>
<div class="paragraph">
<p>The Java EE Web Profile is a profile of the Java EE Platform
specifically targeted at modern web applications. The complete set of
specifications defined in the Web Profile is defined in the Java EE 7
Web Profile Specification. GlassFish can be downloaded in two different
flavors – Full Platform or Web Profile.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This lab requires Full Platform download. All technologies used in this
lab, except Java Message Service and Batch Applications for the Java
Platform, can be deployed on Web Profile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>3.4</strong> <strong>Default Data Source</strong>: Expand "Other Sources",
"src/main/resources", "META-INF", and double-click on "persistence.xml".
By default, NetBeans opens the file in Design View. Click on Source tab
to view the XML source.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.2-persistence-xml.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>It looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence
    version="2.1"
    xmlns="http://xmlns.jcp.org/xml/ns/persistence"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
    http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"&gt;
    &lt;persistence-unit name="movieplex7PU" transaction-type="JTA"&gt;
        &lt;!--
            &lt;jta-data-source&gt;java:comp/DefaultDataSource&lt;/jta-data-source&gt;
        --&gt;
        &lt;properties&gt;
            &lt;property
                name="javax.persistence.schema-generation.database.action"
                value="drop-and-create"/&gt;
            &lt;property
                name="javax.persistence.schema-generation.create-source"
                value="script"/&gt;
            &lt;property
                name="javax.persistence.schema-generation.drop-source"
                value="script"/&gt;
            &lt;property
                name="javax.persistence.schema-generation.drop-script-source"
                value="META-INF/drop.sql"/&gt;
            &lt;property
                name="javax.persistence.sql-load-script-source"
                value="META-INF/load.sql"/&gt;
            &lt;property
                name="eclipselink.deploy-on-startup"
                value="true"/&gt;
            &lt;property
                name="eclipselink.logging.exceptions"
                value="false"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice <code>&lt;jta-data-source&gt;</code> is commented out, i.e. no data source element
is specified. This element identifies the JDBC resource to connect to in
the runtime environment of the underlying application server.</p>
</div>
<div class="paragraph">
<p>The Java EE 7 platform defines a new default data source that must be
provided by the runtime. This pre-configured data source is accessible
under the JNDI name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">java:comp/DefaultDataSource</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JPA 2.1 specification says if neither <code>jta-data-source</code> nor
<code>non-jta-data-source</code> elements are specified, the deployer must specify a
JTA data source or the default JTA data source must be provided by the
container.</p>
</div>
<div class="paragraph">
<p>For GlassFish 4, the default data source is bound to the JDBC resource
<code>jdbc/__default</code>.</p>
</div>
<div class="paragraph">
<p>Clicking back and forth between "Design" and "Source" view may prompt
the error shown below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.4-missing-server.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This will get resolved when we run the application. Click on "OK" to
dismiss the dialog.</p>
</div>
<div class="paragraph">
<p><strong>3.5</strong> <strong>Schema Generation:</strong> JPA 2.1 defines a new set of
<code>javax.persistence.schema-generation.*</code> properties that can be used to
generate database artifacts like tables, indexes, and constraints in a
database schema. This helps in prototyping of your application where the
required artifacts are generated either prior to application deployment
or as part of <code>EntityManagerFactory</code> creation. This feature will allow
your JPA domain object model to be directly generated in a database. The
generated schema may need to be tuned for actual production environment.</p>
</div>
<div class="paragraph">
<p>The "persistence.xml" in the application has the following
<code>javax.persistence.schema-generation.*</code> properties. Their meaning and
possible values are explained:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.persistence.schema-generation.database.action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the action to be taken by the persistence provider with regard
to the database artifacts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code>, <code>create</code>, <code>drop-and-create</code>, <code>drop</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.persistence.schema-generation.create-source</code>
 <code>javax.persistence.schema-generation.drop-source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the creation or deletion of database artifacts is to
occur on the basis of the object/relational mapping metadata, DDL
script, or a combination of the two.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code>, <code>script</code>, <code>metadata-then-script</code>, <code>script-then-metadata</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.persistence.schema-generation.create-script-source</code>
 <code>javax.persistence.schema-generation.drop-script-source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a <code>java.IO.Reader</code> configured for reading of the SQL script or a
string designating a file URL for the SQL script to create or delete
database artifacts.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.persistence.sql-load-script-source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a <code>java.IO.Reader</code> configured for reading of the SQL load script
for database initialization or a string designating a file URL for the
script.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Refer to the <a href="http://jcp.org/en/jsr/detail?id=338">JPA 2.1 Specification</a>
for a complete understanding of these properties.</p>
</div>
<div class="paragraph">
<p>In the application, the scripts are bundled in the WAR file in
"META-INF" directory. As the location of these scripts is specified as a
URL, the scripts may be loaded from outside the WAR file as well.</p>
</div>
<div class="paragraph">
<p>Feel free to open "create.sql", "drop.sql" and "load.sql" and read
through the SQL scripts. The database schema is shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.5-schema.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This folder also contains "sales.csv" which carries some comma-separated
data, and is used later in the application.</p>
</div>
<div class="paragraph">
<p><strong>3.6</strong> <strong>JPA entities, Stateless EJBs, and REST endpoints</strong>: Expand "Source
Packages". The package <code>org.glassfish.movieplex7.entities</code> contains the
JPA entities corresponding to the database table definitions. Each JPA
entity has several convenient @NamedQuery defined and uses Bean
Validation constraints to enforce validation.</p>
</div>
<div class="paragraph">
<p>The package <code>org.glassfish.movieplex7.rest</code> contains stateless EJBs
corresponding to different JPA entities.</p>
</div>
<div class="paragraph">
<p>Each EJB has methods to perform CRUD operations on the JPA entity and
convenience query methods. Each EJB is also EL-injectable (@Named) and
published as a REST endpoint (@Path). The AplicationConfig class defines
the base path of REST endpoint. The path for the REST endpoint is the
same as the JPA entity class name.</p>
</div>
<div class="paragraph">
<p>The mapping between JPA entity classes, EJB classes, and the URI of the
corresponding REST endpoint is shown.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JPA Entity Class</th>
<th class="tableblock halign-left valign-top">EJB Class</th>
<th class="tableblock halign-left valign-top">RESTful Path</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Movie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MovieFacadeREST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webresources/movie</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sales</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SalesFacadeREST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webresources/sales</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ShowTiming</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ShowTimingFacadeREST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webresources/showtiming</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Theater</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TheaterFacadeREST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webresources/theater</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timeslot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimeslotFacadeREST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/webresources/timeslot</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Feel free to browse through the code.</p>
</div>
<div class="paragraph">
<p><strong>3.7</strong> <strong>JSF pages</strong>: "WEB-INF/template.xhtml" defines the template of the
web page and has a header, left navigation bar, and a main content
section. "index.xhtml" uses this template and the EJBs to display the
number of movies and theaters.</p>
</div>
<div class="paragraph">
<p>Java EE 7 enables CDI discovery of beans by default. No "beans.xml" is
required in "WEB-INF". This allows all beans with bean defining
annotation, i.e. either a bean with an explicit CDI scope or EJBs to be
available for injection.</p>
</div>
<div class="paragraph">
<p>Note, "template.xhtml" is in "WEB-INF" folder as it allows the template
to be accessible from the pages bundled with the application only. If it
were bundled with rest of the pages then it would be accessible outside
the application and thus allowing other external pages to use it as
well.</p>
</div>
<div class="paragraph">
<p><strong>3.8</strong> <strong>Run the sample</strong>: Right-click on the project and select "Run".
This will download all the maven dependencies on your machine, build a
WAR file, deploy on GlassFish 4, and show the URL
<a href="http://localhost:8080/movieplex7">localhost:8080/movieplex7</a> in the
default browser configured in NetBeans. Note that this could take a
while if you have never built a Maven application on your machine.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The project will show red squiggly lines in the source code indicating
that the classes cannot be resolved. This is expected before the
dependencies are downloaded. However these references will be resolved
correctly after the dependencies are downloaded during project building.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During the first run, the IDE will ask you to select a deployment
server. Choose the configured GlassFish server and click on "OK".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.6-glassfish-server.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The output looks like as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/3.8-first-page.png" alt="image"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket">4. Chat Room (Java API for WebSocket)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: Build a chat room for viewers. In doing so several new
features of Java API for WebSocket 1.0 will be introduced and
demonstrated by using them in the application.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>WebSocket provide a full-duplex and bi-directional communication
protocol over a single TCP connection. WebSocket is a combination of
<a href="http://tools.ietf.org/html/rfc6455">IETF RFC 6455</a>
<a href="http://tools.ietf.org/html/rfc6455">Protocol</a> and
<a href="http://www.w3.org/TR/websockets/">W3C JavaScript WebSocket API</a> (a
Candidate Recommendation as of this writing). The protocol defines an
opening handshake and data transfer. The API enables Web pages to use
the WebSocket protocol for two-way communication with the remote host.</p>
</div>
<div class="paragraph">
<p><a href="http://jcp.org/en/jsr/detail?id=356">JSR 356</a> defines a standard API for
creating WebSocket applications in the Java EE 7 Platform. The JSR
provides support for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create WebSocket endpoint using annotations and interface</p>
</li>
<li>
<p>Initiating and intercepting WebSocket events</p>
</li>
<li>
<p>Creation and consumption of WebSocket text and binary messages</p>
</li>
<li>
<p>Configuration and management of WebSocket sessions</p>
</li>
<li>
<p>Integration with Java EE security model</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section will build a chat room for movie viewers.</p>
</div>
<div class="paragraph">
<p><strong>4.1</strong> Right-click on "Source Packages", select "New", "Java Class…".
Give the class name as "ChatServer", package as
<code>org.glassfish.movieplex7.chat</code>, and click on "Finish".</p>
</div>
<div class="paragraph">
<p><strong>4.2</strong> Change the class such that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@ServerEndpoint("/websocket")
public class ChatServer {
    private static final Set&lt;Session&gt; peers =
               Collections.synchronizedSet(new HashSet&lt;Session&gt;());

    @OnOpen
    public void onOpen(Session peer) {
        peers.add(peer);
    }

    @OnClose
    public void onClose(Session peer) {
        peers.remove(peer);
    }

    @OnMessage
    public void message(String message, Session client)
           throws IOException, EncodeException {
        for (Session peer : peers) {
            peer.getBasicRemote().sendObject(message);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ServerEndpoint</code> decorates the class to be a WebSocket endpoint. The
value defines the URI where this endpoint is published.</p>
</li>
<li>
<p><code>@OnOpen</code> and <code>@OnClose</code> decorate the methods that must be called when
WebSocket session is opened or closed. The peer parameter defines the
client requesting connection initiation and termination.</p>
</li>
<li>
<p><code>@OnMessage</code> decorates the message that receives the incoming WebSocket
message. The first parameter, message, is the payload of the message.
The second parameter, client, defines the other end of the WebSocket
connection. The method implementation transmits the received message to
all clients connected to this endpoint.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Resolve the imports by right-clicking in the editor and selecting "Fix
Imports" or (Command + Shift + I shortcut on Mac or Ctrl + Shift + I on
Windows).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to pick <code>java.websocket.Session</code> for resolving imports.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/4.2-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Right-click again in the editor pane and select "Format" to format your
code.</p>
</div>
<div class="paragraph">
<p><strong>4.3</strong> In "Web Pages", select "New", "Folder…", give the folder name as
"chat" and click on "Finish".</p>
</div>
<div class="paragraph">
<p><strong>4.4</strong> Right-click on the newly created folder, select "New", "Other&#8230;",
"Java Server Faces", "Facelets Template Client", give the File Name as
"chatroom". Click on "Browse…" next to "Template:", expand "Web Pages",
"WEB-INF", select "template.xhtml", and click on "Select File". Click on
"Finish".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/4.4-template.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>In this file, remove &lt;ui:define&gt; sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p>Replace <code>&lt;ui:define&gt;</code> section with "content" name such that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;form action=""&gt;
        &lt;table&gt;
            &lt;tr&gt;
                &lt;td&gt;
                    Chat Log&lt;br/&gt;
                    &lt;textarea readonly="true" rows="6" cols="50" id="chatlog"&gt;&lt;/textarea&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    Users&lt;br/&gt;
                    &lt;textarea readonly="true" rows="6" cols="20" id="users"&gt;&lt;/textarea&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td colspan="2"&gt;
                    &lt;input id="textField" name="name" value="Duke" type="text"/&gt;
                    &lt;input onclick="join();" value="Join" type="button"/&gt;
                    &lt;input onclick="send_message();" value="Send" type="button"/&gt;&lt;p/&gt;
                    &lt;input onclick="disconnect();" value="Disconnect" type="button"/&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
    &lt;/form&gt;
    &lt;div id="output"&gt;&lt;/div&gt;
        &lt;script language="javascript" type="text/javascript"
            src="${facesContext.externalContext.requestContextPath}/chat/websocket.js"&gt;&lt;/script&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code builds an HTML form that has two textareas – one to display the
chat log and the other to display the list of users currently logged. A
single text box is used to take the user name or the chat message.
Clicking on "Join" button takes the value as user name and clicking on
"Send" takes the value as chat message.</p>
</div>
<div class="paragraph">
<p>JavaScript methods are invoked
when these buttons are clicked and these are explained in the next
section. The chat messages are sent and received as WebSocket payloads.
There is an explicit button to disconnect the WebSocket connection.
"output" div is the placeholder for status messages. The WebSocket
initialization occurs in "websocket.js" included at the bottom of the
fragment.</p>
</div>
<div class="paragraph">
<p><strong>4.5</strong> Right-click on "chat" in "Web Pages", select "New", "Other&#8230;",
"Web", "JavaScript File".</p>
</div>
<div class="paragraph">
<p>Give the name as "websocket" and click on "Finish".</p>
</div>
<div class="paragraph">
<p><strong>4.6</strong> Edit the contents of "websocket.js" such that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="javascript language-javascript">var wsUri = 'ws://' + document.location.host
            + document.location.pathname.substr(0,
              document.location.pathname.indexOf("/faces")) +
              '/websocket';
console.log(wsUri);

var websocket = new WebSocket(wsUri);
var textField = document.getElementById("textField");
var users = document.getElementById("users");
var chatlog = document.getElementById("chatlog");
var username;

websocket.onopen = function(evt) \{ onOpen(evt); };
websocket.onmessage = function(evt) \{ onMessage(evt); };
websocket.onerror = function(evt) \{ onError(evt); };
websocket.onclose = function(evt) \{ onClose(evt); };

var output = document.getElementById("output");

function join() \{
    username = textField.value;
    websocket.send(username + " joined");
}

function send_message() \{
    websocket.send(username + ": " + textField.value);
}

function onOpen() \{
    writeToScreen("CONNECTED");
}

function onClose() \{
    writeToScreen("DISCONNECTED");
}

function onMessage(evt) \{
    writeToScreen("RECEIVED: " + evt.data);
    if (evt.data.indexOf("joined") !== -1) \{
        users.innerHTML += evt.data.substring(0, evt.data.indexOf(" joined")) + "\n";
    } else \{
        chatlog.innerHTML += evt.data + "\n";
    }
}

function onError(evt) \{
    writeToScreen('&lt;span style="color: red;"&gt;ERROR:&lt;/span&gt; ' + evt.data);
}

function disconnect() \{
    websocket.close();
}

function writeToScreen(message) \{
    var pre = document.createElement("p");
    pre.style.wordWrap = "break-word";
    pre.innerHTML = message;
    output.appendChild(pre);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The WebSocket endpoint URI is calculated by using standard JavaScript
variables and appending the URI specified in the <code>ChatServer</code> class.
WebSocket is initialized by calling new <code>WebSocket(…)</code>. Event handlers are
registered for lifecycle events using <code>onXXX</code> messages. The listeners
registered in this script are explained in the table.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:25%;">
<col style="width:75%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Listeners</th>
<th class="tableblock halign-left valign-top">Called When</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onOpen(evt)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket connection is initiated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onMessage(evt)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket message is received</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onError(evt)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error occurs during the communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onClose(evt)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket connection is terminated</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Any relevant data is passed along as parameter to the function. Each
method prints the status on the browser using <code>writeToScreen</code> utility
method. The join method sends a message to the endpoint
that a particular user has joined. The endpoint then broadcasts the
message to all the listening clients. The <code>send_message</code> method appends
the logged in user name and the value of the text field and broadcasts
to all the clients similarly. The <code>onMessage</code> method updates the list of
logged in users as well.
<span class="image"><img src="images/4.6-chatroom.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>4.7</strong> Edit "WEB-INF/template.xhtml" and change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:outputLink value="item2.xhtml"&gt;Item 2&lt;/h:outputLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:outputLink
    value="${facesContext.externalContext.requestContextPath}/faces/chat/chatroom.xhtml"&gt;
    Chat Room
&lt;/h:outputLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>outputLink</code> tag renders an HTML anchor tag with an <code>href</code> attribute.
<code>${facesContext.externalContext.requestContextPath}</code> provides the request
URI that identifies the web application context for this request. This
allows the links in the left navigation bar to be fully-qualified URLs.</p>
</div>
<div class="paragraph">
<p><strong>4.8</strong> Run the project by right clicking on the project and selecting
"Run". The browser shows
<a href="http://localhost:8080/movieplex7">localhost:8080/movieplex7</a>.</p>
</div>
<div class="paragraph">
<p>Click on "Chat Room" to see the output.</p>
</div>
<div class="paragraph">
<p>The "CONNECTED" status message is shown and indicates that the WebSocket
connection with the endpoint is established.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/4.8-chatroom.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Please make sure your browser supports WebSocket in order for this page
to show up successfully. Chrome 14.0+, Firefox 11.0+, Safari 6.0+, and
IE 10.0+ are the browsers that support WebSocket. A complete list of
supported browsers is available at
<a href="http://caniuse.com/websockets">caniuse.com/websockets</a>.</p>
</div>
<div class="paragraph">
<p>Open the URI <a href="http://localhost:8080/movieplex7">localhost:8080/movieplex7</a>
in another browser window. Enter "Duke" in the text box in the first
browser and click "Join".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/4.8-chatroom-joined.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Notice that the user list and the status message in both the browsers
gets updated. Enter "James" in the text box of the second browser and
click on "Join". Once again the user list and the status message in both
the browsers is updated. Now you can type any messages in any of the
browser and click on "Send" to send the message.</p>
</div>
<div class="paragraph">
<p>The output from two different browsers after the initial greeting looks
like as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/4.8-chatroom-two-browsers.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Here it shows output from Chrome on the top and Firefox on the bottom.</p>
</div>
<div class="paragraph">
<p>Chrome Developer Tools or Firebug in Firefox can be used to monitor
WebSocket traffic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch">5. Ticket Sales (Batch Applications for the Java Platform)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: Read the total sales for each show and populate the database.
In doing so several new features of Java API for Batch Processing 1.0
will be introduced and demonstrated by using them in the application.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>Batch Processing is execution of series of "jobs" that is suitable for
non-interactive, bulk-oriented and long-running tasks. Batch
Applications for the Java Platform (JSR 352) will define a programming
model for batch applications and a runtime for scheduling and executing
jobs.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/5.0-batch-intro.png" alt="image"></span><br></p>
</div>
<div class="paragraph">
<p>The core concepts of Batch Processing are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>Job</strong> is an instance that encapsulates an entire batch process. A
job is typically put together using a Job Specification Language and
consists of multiple steps. The Job Specification Language for JSR 352
is implemented with XML and is referred as "Job XML".</p>
</li>
<li>
<p>A <strong>Step</strong> is a domain object that encapsulates an independent,
sequential phase of a job. A step contains all of the information
necessary to define and control the actual batch processing.</p>
</li>
<li>
<p><strong>JobOperator</strong> provides an interface to manage all aspects of job
processing, including operational commands, such as start, restart, and
stop, as well as job repository commands, such as retrieval of job and
step executions.</p>
</li>
<li>
<p><strong>JobRepository</strong> holds information about jobs current running and jobs
that run in the past. JobOperator provides access to this repository.</p>
</li>
<li>
<p>Reader-Processor-Writer pattern is the primary pattern and is called
as <strong>Chunk-oriented<strong> </strong>Processing</strong>. In this, <strong>ItemReader</strong> reads one item
at a time, <strong>ItemProcessor</strong> processes the item based upon the business
logic, such as calculate account balance and hands it
to <strong>ItemWriter</strong> for aggregation. Once the <em>chunk</em> numbers of items are
aggregated, they are written out, and the transaction is committed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section will read the cumulative sales for each show from a CSV
file and populate them in a database.</p>
</div>
<div class="paragraph">
<p><strong>5.1</strong> Right-click on Source Packages, select "New", "Java Package…",
specify the value as "org.glassfish.movieplex7.batch", and click on
"Finish".</p>
</div>
<div class="paragraph">
<p><strong>5.2</strong> Right-click on newly created package, select "New", "Java Class…",
specify the name as "SalesReader". Make this class extend from
<code>AbstractItemReader</code>, change the class definition and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">extends AbstractItemReader</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AbstractItemReader</code> is an abstract class that implements <code>ItemReader</code>
interface. The <code>ItemReader</code> interface defines methods that read a stream
of items for chunk processing. This reader implementation returns a
String item type as indicated in the class definition.</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> as a class-level annotations and it allows the bean to be
injected in Job XML. Add <code>@Dependent</code> as another class-level annotation to
mark this bean as a bean defining annotation so that this bean is
available for injection.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.3</strong> Add the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">private BufferedReader reader;

Override open() method to initialize the reader:
public void open(Serializable checkpoint) throws Exception \{
    reader = new BufferedReader(
        new InputStreamReader(
        Thread.currentThread()
            .getContextClassLoader()
            .getResourceAsStream("META-INF/sales.csv")));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method initializes a BufferedReader from "META-INF/sales.csv" that
is bundled with the application.</p>
</div>
<div class="paragraph">
<p>Sampling of the first few lines from "sales.csv" is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="csv language-csv">1,500.00
2,660.00
3,80.00
4,470.00
5,1100.x0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each line has a show identifier comma separated by the total sales for
that show. Note that the last line (5<sup>th</sup> record in the sample) has an
intentional typo. In addition, 17<sup>th</sup> record also has an additional
typo. The lab will use these lines to demonstrate how to handle parsing
errors.</p>
</div>
<div class="paragraph">
<p><strong>5.4</strong> Override the following method from the abstract class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Override
public String readItem() {
    String string = null;
    try {
        string = reader.readLine();
    } catch (IOException ex) {
        ex.printStackTrace();
    }
    return string;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>readItem</code> method returns the next item from the stream. It returns
<code>null</code> to indicate end of stream. Note end of stream indicates end of chunk,
so the current chunk will be committed and the step will end.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.5</strong> Right-click on "org.glassfish.movieplex7.batch" package, select
"New", "Java Class…", specify the name as "SalesProcessor". Change the
class definition and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">implements ItemProcessor</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ItemProcessor</code> is an interface that defines a method that is used to
operate on an input item and produce an output item. This processor
accepts a String input item from the reader, <code>SalesReader</code> in our case,
and returns a <code>Sales</code> instance to the writer (coming shortly). <code>Sales</code> is
the pre-packaged JPA entity with the application starter source code.</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> and <code>@Dependent</code> as class-level annotations so that it allows
the bean to be injected in Job XML.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.6</strong> Add implementation of the abstract method from the interface as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Override
public Sales processItem(Object s) {
    Sales sales = new Sales();
    StringTokenizer tokens = new StringTokenizer((String)s, ",");
    sales.setId(Integer.parseInt(tokens.nextToken()));
    sales.setAmount(Float.parseFloat(tokens.nextToken()));

    return sales;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method takes a <code>String</code> parameter coming from the <code>SalesReader</code>, parses
the value, populates them in the <code>Sales</code> instance, and returns it. This is
then aggregated with the writer.</p>
</div>
<div class="paragraph">
<p>The method can return null indicating that the item should not be
aggregated. For example, the parsing errors can be handled within the
method and return null if the values are not correct. However this
method is implemented where any parsing errors are thrown as exception.
Job XML can be instructed to skip these exceptions and thus that
particular record is skipped from aggregation as well (shown later).</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.7</strong> Right-click on "org.glassfish.movieplex7.batch" package, select
"New", "Java Class…", specify the name as "SalesWriter". Change the
class definition and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">extends AbstractItemWriter</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AbstractItemWriter</code> is an abstract class that implements <code>ItemWriter</code>
interface. The ItemWriter interface defines methods that write to a
stream of items for chunk processing. This writer writes a list of <code>Sales</code>
items.</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> and <code>@Dependent</code> as class-level annotations so that it allows
the bean to be injected in Job XML.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.8</strong> Inject <code>EntityManager</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@PersistenceContext EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Override the following method from the abstract class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Override
@Transactional
public void writeItems(List list) {
    for (Sales s : (List&lt;Sales&gt;)list) {
        em.persist(s);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Batch runtime aggregates the list of <code>Sales</code> instances returned from the
<code>SalesProessor</code> and makes it available as List in this method. This method
iterates over the list and persist each item in the database.</p>
</div>
<div class="paragraph">
<p>The method also specifies <code>@Transactional</code> as a method level annotation.
This is a new annotation introduced by JTA 1.2 that provides the ability
to control transaction boundaries on CDI managed beans. This provides
the semantics of EJB transaction attributes in CDI beans without
dependencies such as RMI. This support is implemented via an
implementation of a CDI interceptor that conducts the necessary
suspending, resuming, etc. </p>
</div>
<div class="paragraph">
<p>In this case, a transaction is automatically started before the method
is called, committed if no checked exceptions are thrown, and rolled
back if runtime exceptions are thrown. This behavior can be overridden
using <code>rollbackOn</code> and <code>dontRollbackOn</code> attributes of the annotation.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.9</strong> Create Job XML that defines the job, step, and chunk.</p>
</div>
<div class="paragraph">
<p>In "Files" tab, expand the project &#8594; "src" &#8594; "main" &#8594; "resources",
right-click on "resources", "META-INF", select "New", "Folder…", specify
the name as "batch-jobs", and click on "Finish".</p>
</div>
<div class="paragraph">
<p>Right-click on the newly created folder, select "New", "Other…", select
"XML", "XML Document", click on "Next &gt;", give the name as "eod-sales",
click on "Next", take the default, and click on "Finish".</p>
</div>
<div class="paragraph">
<p>Replace contents of the file with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;job id="endOfDaySales"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee[http://xmlns.jcp.org/xml/ns/javaee]"
    version="1.0"&gt;
    &lt;step id="populateSales"&gt;
        &lt;chunk item-count="3" skip-limit="5"&gt;
            &lt;reader ref="salesReader"/&gt;
            &lt;processor ref="salesProcessor"/&gt;
            &lt;writer ref="salesWriter"/&gt;
            &lt;skippable-exception-classes&gt;
                &lt;include class="java.lang.NumberFormatException"/&gt;
            &lt;/skippable-exception-classes&gt;
        &lt;/chunk&gt;
    &lt;/step&gt;
&lt;/job&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code shows that the job has one step of chunk type. The <code>&lt;reader&gt;</code>,
<code>&lt;processor&gt;</code>, and <code>&lt;writer&gt;</code> elements define the CDI bean name of the
implementations of <code>ItemReader</code>, <code>ItemProcessor</code>, and <code>ItemWriter</code> interfaces.
The <code>item-count</code> attribute defines that 3 items are
read/processed/aggregated and then given to the writer. The entire
reader/processor/writer cycle is executed within a transaction. The
<code>&lt;skippable-exception-classes&gt;</code> element specifies a set of exceptions to
be skipped by chunk processing.</p>
</div>
<div class="paragraph">
<p>CSV file used for this lab has intentionally introduced couple of typos
that would generate <code>NumberFormatException</code>. Specifying this element
allows skipping the exception, ignore that particular element, and
continue processing. If this element is not specified then the batch
processing will halt. The <code>skip-limit</code> attribute specifies the number of
exceptions a step will skip.</p>
</div>
<div class="paragraph">
<p><strong>5.10</strong> Lets invoke the batch job.</p>
</div>
<div class="paragraph">
<p>Right-click on "org.glassfish.movieplex7.batch" package, select "New",
"Java Class…". Enter the name as "SalesBean" and click on "Finish"
button.</p>
</div>
<div class="paragraph">
<p>Add the following code to the bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public void runJob() {
    try {
        JobOperator jo = BatchRuntime.getJobOperator();
        long jobId = jo.start("eod-sales", new Properties());
        System.out.println("Started job: with id: " + jobId);
    } catch (JobStartException ex) \{
        ex.printStackTrace();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method uses <code>BatchRuntime</code> to get an instance of <code>JobOperator</code>, which
is then used to start the job. <code>JobOperator</code> is the interface for
operating on batch jobs. It can be used to start, stop, and restart
jobs. It can additionally inspect job history, to discover what jobs are
currently running and what jobs have previously run.</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> and <code>@RequestScoped</code> as class-level annotations. This allows
the bean to be injectable in an EL expression.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/5.10-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>5.11</strong> Inject EntityManagerFactory in the class as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@PersistenceUnit EntityManagerFactory emf;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and add the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public List&lt;Sales&gt; getSalesData() {
    return emf.
        createEntityManager().
        createNamedQuery("Sales.findAll", Sales.class).
        getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method uses a pre-defined <code>@NamedQuery</code> to query the database and
return all the rows from the table.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>5.12</strong> Right-click on "Web Pages", select "New", "Folder…", specify the
name as "batch", and click on "Finish".</p>
</div>
<div class="paragraph">
<p>Right-click on the newly created folder, select "New", "Other…",
"JavaServer Faces", "Facelets Template Client", and click on "Next &gt;".</p>
</div>
<div class="paragraph">
<p>Give the File Name as "sales". Click on "Browse…" next to "Template:",
expand "Web Pages", "WEB-INF", select "template.xhtml", and click on
"Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p>Replace <code>&lt;ui:define&gt;</code> section with "content" name such that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;h1&gt;Movie Sales&lt;/h1&gt;
    &lt;h:form&gt;
        &lt;h:dataTable value="#{salesBean.salesData}" var="s" border="1"&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Show ID" /&gt;
                &lt;/f:facet&gt;
                #{s.id}
            &lt;/h:column&gt;
            &lt;h:column&gt;
                &lt;f:facet name="header"&gt;
                    &lt;h:outputText value="Sales" /&gt;
                &lt;/f:facet&gt;
                #{s.amount}
            &lt;/h:column&gt;
        &lt;/h:dataTable&gt;
        &lt;h:commandButton
            value="Run Job"
            action="sales"
            actionListener="#{salesBean.runJob()}"/&gt;
        &lt;h:commandButton
            value="Refresh"
            action="sales" /&gt;
    &lt;/h:form&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code displays the show identifier and sales from that show in a
table by invoking <code>SalesBean.getSalesData()</code>. First command button allows
invoking the job that processes the CSV file and populates the database.
The second command button refreshes the page.</p>
</div>
<div class="paragraph">
<p>Right-click on the yellow bulb to fix namespace prefix/URI mapping. This
needs to be repeated for h: and f: prefix.</p>
</div>
<div class="paragraph">
<p><strong>5.13</strong> Add the following code in "template.xhtml" along with other
`&lt;outputLink&gt;`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;p/&gt;&lt;h:outputLink
    value="${facesContext.externalContext.requestContextPath}/faces/batch/sales.xhtml"&gt;
    Sales
    &lt;/h:outputLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>5.14</strong> Run the project to see the output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/5.14-sales.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Notice, a new "Sales" entry is displayed in the left navigation bar.</p>
</div>
<div class="paragraph">
<p><strong>5.15</strong> Click on "Sales" to see the output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/5.15-sales.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The empty table indicates that there is no sales data in the database.</p>
</div>
<div class="paragraph">
<p><strong>5.16</strong> Click on "Run Job" button to initiate data processing of CSV
file. Look for "Waiting for localhost&#8230;" in the browser status bar,
wait for a couple of seconds for the processing to finish, and then
click on "Refresh" button to see the updated output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/5.16-sales-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Now the table is populated with the sales data.</p>
</div>
<div class="paragraph">
<p>Note that record 5 is missing from the table, as this records did not
have correct numeric entries for the sales total. The Job XML for the
application explicitly mentioned to skip such errors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jaxrs">6. View and Delete Movie (Java API for RESTful Web Services)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: View, and delete a movie. In doing so several new features of
JAX-RS 2 will be introduced and demonstrated by using them in the
application.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>JAX-RS 2 defines a standard API to create, publish, and invoke a REST
endpoint. JAX-RS 2 adds several new features to the API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client API that can be used to access Web resources and provides
integration with JAX-RS Providers. Without this API, the users need to
use a low-level HttpUrlConnection to access the REST endpoint.</p>
</li>
<li>
<p>Asynchronous processing capabilities in Client and Server that enables
more scalable applications.</p>
</li>
<li>
<p>Message Filters and Entity Interceptors as well-defined extension
points to extend the capabilities of an implementation.</p>
</li>
<li>
<p>Validation constraints can be specified to validate the parameters and
return type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section will provide the ability to view all the movies, details of
a selected movie, and delete an existing movie using the JAX-RS Client
API.</p>
</div>
<div class="paragraph">
<p><strong>6.1</strong> Right-click on "Source Packages", select "New", "Java Class…".
Give the class name as "MovieClientBean", package as
"org.glassfish.movieplex7.client", and click on "Finish".</p>
</div>
<div class="paragraph">
<p>This bean will be used to invoke the REST endpoint.</p>
</div>
<div class="paragraph">
<p><strong>6.2</strong> Add <code>@Named</code> and <code>@RequestScoped</code> class-level annotations. This allows
the class to be injected in an EL expression and also defines the bean
to be automatically activated and passivated with the request.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to pick <code>javax.enterprise.context.RequestScoped</code> class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/6.2-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>6.3</strong> Add the following code to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Client client;
WebTarget target;

@PostConstruct
public void init() {
    client = ClientBuilder.newClient();
    target = client.target("http://localhost:8080/movieplex7/webresources/movie/");
}

@PreDestroy
public void destroy() \{
    client.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClientBuilder</code> is the main entry point to the Client API. It uses a
fluent builder API to invoke REST endpoints. A new <code>Client</code> instance is
created using the default client builder implementation provided by the
JAX-RS implementation provider. Client are heavy-weight objects that
manage the client-side communication infrastructure. It is highly
recommended to create only required number of instances of Client and
close it appropriately.</p>
</div>
<div class="paragraph">
<p>In this case, <code>Client</code> instance is created and destroyed in the lifecycle
callback methods. The endpoint URI is set on this instance by calling
the target method.</p>
</div>
<div class="paragraph">
<p><strong>6.4</strong> Add the following method to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public Movie[] getMovies() {
    return target
        .request()
        .get(Movie[].class);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A request is prepared by calling the request method. HTTP GET method is
invoked by calling get method. The response type is specified in the
last method call and so return value is of the type Movie[].</p>
</div>
<div class="paragraph">
<p><strong>6.5</strong> Right-click on "Web Pages", select "New", "Folder…", specify the
name as "client", and click on "Finish".</p>
</div>
<div class="paragraph">
<p>Right-click on the newly created folder, select "New", "Other…",
"JavaServer Faces", "Facelets Template Client", and click on "Next &gt;".</p>
</div>
<div class="paragraph">
<p>Give the File Name as "movies". Click on "Browse…" next to "Template:",
expand "Web Pages", "WEB-INF", select "template.xhtml", and click on
"Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p><strong>6.6</strong> Replace the content inside <code>&lt;ui:define&gt;</code> with "content" with the
code fragment shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:form prependId="false"&gt;
    &lt;h:selectOneRadio value="#{movieBackingBean.movieId}" layout="pageDirection"&gt;
        &lt;c:forEach items="#{movieClientBean.movies}" var="m"&gt;
            &lt;f:selectItem itemValue="#{m.id}" itemLabel="#{m.name}"/&gt;
        &lt;/c:forEach&gt;
    &lt;/h:selectOneRadio&gt;
    &lt;h:commandButton value="Details" action="movie" /&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code fragment invokes getMovies method from <code>MovieClientBean</code>,
iterates over the response in a for loop, and display the name of each
movie with a radio button. The selected radio button value is bound to
the EL expression <code>#{movieBackingBean.movieId}</code>.</p>
</div>
<div class="paragraph">
<p>The code also has a button with "Details" label and looks for
"movie.xhtml" in the same directory. We will create this file later.</p>
</div>
<div class="paragraph">
<p>Click on the yellow bulb in the left bar to resolve the namespace
prefix-to-URI resolution. This needs to be completed for – for <code>h:</code>, <code>c:</code>,
and <code>f:</code> prefixes.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/6.6-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>6.7</strong> Right-click on "org.glassfish.movieplex7.client" package, select
"New", "Java Class…", specify the value as "MovieBackingBean" and click
on "Finish".</p>
</div>
<div class="paragraph">
<p>Add the following field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">int movieId;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add getters/setters by right-clicking on the editor pane and selecting
"Insert Code…" (Ctrl + I shortcut on Mac). Select the field and click on
"Generate".</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> and <code>@SessionScoped</code> class-level annotations and implements
<code>Serializable</code>.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to import <code>javax.enterprise.context.SessionScoped</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>6.8</strong> In "template.xhtml", add the following code in <code>&lt;ui:insert&gt;</code> with
name="left".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;p/&gt;&lt;h:outputLink
        value="${facesContext.externalContext.requestContextPath}/faces/client/movies.xhtml"&gt;
        Movies
    &lt;/h:outputLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the project (Fn + F6 shortcut on Mac) and clicking on "Movies"
in the left navigation bar shows the output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/6.8-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The list of all the movies with a radio button next to them is
displayed.</p>
</div>
<div class="paragraph">
<p><strong>6.9</strong> In <code>MovieClientBean</code>, inject <code>MovieBackingBean</code> to read the value
of selected movie from the page. Add the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Inject
MovieBackingBean bean;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>6.10</strong> In <code>MovieClientBean</code>, add the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public Movie getMovie() {
    Movie m = target
        .path("{movie}")
        .resolveTemplate("movie", bean.getMovieId())
        .request()
        .get(Movie.class);
    return m;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code reuses the <code>Client</code> and <code>WebTarget</code> instances created in
<code>@PostConstruct</code>. It also adds a variable part to the URI of the REST
endpoint, defined using <code>{movie}</code>, and binds it to a concrete value using
<code>resolveTemplate</code> method. The return type is specified as a parameter to
the get method.</p>
</div>
<div class="paragraph">
<p><strong>6.11</strong> Right-click on "client" folder, select "New", "Facelets Template
Client", give the File Name as "movie". Click on "Browse…" next to
"Template:", expand "Web Pages", "WEB-INF", select "template.xhtml", and
click on "Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p>Replace the content inside <code>&lt;ui:define&gt;</code> with "content" with the code
fragment shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h1&gt;Movie Details&lt;/h1&gt;
&lt;h:form&gt;
    &lt;table cellpadding="5" cellspacing="5"&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Id:&lt;/th&gt;
            &lt;td&gt;#{movieClientBean.movie.id}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Name:&lt;/th&gt;
            &lt;td&gt;#{movieClientBean.movie.name}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Actors:&lt;/th&gt;
            &lt;td&gt;#{movieClientBean.movie.actors}&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;h:commandButton value="Back" action="movies" /&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on the yellow-bulb to resolve the namespace prefix-URI mapping for
<code>h:</code>. The output values are displayed by calling the <code>getMovie</code> method and
using the <code>id</code>, <code>name</code>, and <code>actors</code> property values.</p>
</div>
<div class="paragraph">
<p><strong>6.12</strong> Run the project, select "Movies" in the left navigation bar,
select a radio button next to any movie, and click on details to see the
output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/6.12-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on the "Back" button to select another movie.</p>
</div>
<div class="paragraph">
<p><strong>6.13</strong> Add the ability to delete a movie. In "movies.xhtml", add the
following code with the other commandButton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:commandButton
    value="Delete"
    action="movies"
    actionListener="#{movieClientBean.deleteMovie()}"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This button displays a label "Delete", invokes the method deleteMovie
from "MovieClientBean", and then renders "movies.xhtml".</p>
</div>
<div class="paragraph">
<p><strong>6.14</strong> Add the following code to "MovieClientBean":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public void deleteMovie() {
    target
        .path("{movieId}")
        .resolveTemplate("movieId", bean.getMovieId())
        .request()
        .delete();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code again reuses the <code>Client</code> and <code>WebTarget</code> instances created in
<code>@PostConstruct</code>. It also adds a variable part to the URI of the REST
endpoint, defined using <code>{movieId}</code>, and binds it to a concrete value
using <code>resolveTemplate</code> method. The URI of the resource to be deleted is
prepared and then delete method is called to delete the resource.</p>
</div>
<div class="paragraph">
<p>Make sure to resolve the imports.</p>
</div>
<div class="paragraph">
<p>Running the project shows the output shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/6.14-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Select a movie and click on Delete button. This deletes the movie from
the database and refreshes list on the page. Note that a redeploy of the
project will delete all the movies anyway and add them all back.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json">7. Add Movie (Java API for JSON Processing)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: Add a new movie. In doing so several new features of the Java
API for JSON Processing 1.0 will be introduced and demonstrated by using
them in the application.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>Java API for JSON Processing provides a standard API to parse and
generate JSON so that the applications can rely upon a portable API.
This API will provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Produce/Consume JSON in a streaming fashion (similar to StAX API for XML)</p>
</li>
<li>
<p>Build a Java Object Model for JSON (similar to DOM API for XML)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section will define a JAX-RS Entity Providers that will allow
reading and writing JSON for a Movie POJO. The JAX-RS Client API will
request this JSON representation.</p>
</div>
<div class="paragraph">
<p>JAX-RS Entity Providers supply mapping services between on-the-wire
representations and their associated Java types.  Several standard Java
types such as <code>String</code>, <code>byte[]</code>, <code>javax.xml.bind.JAXBElement</code>,
<code>java.io.InputStream</code>, <code>java.io.File</code>, and others have a pre-defined mapping
and is required by the specification. Applications may provide their own
mapping to custom types using <code>MessageBodyReader</code> and <code>MessageBodyWriter</code>
interfaces.</p>
</div>
<div class="paragraph">
<p>This section will provide the ability to add a new movie to the
application. Typically, this functionality will be available after
proper authentication and authorization.</p>
</div>
<div class="paragraph">
<p><strong>7.1</strong> Right-click on Source Packages, select "New", "Java Package…",
specify the value as "org.glassfish.movieplex7.json", and click on
"Finish".</p>
</div>
<div class="paragraph">
<p><strong>7.2</strong> Right-click on newly created package, select "New", "Java Class…",
specify the name as "MovieReader", and click on "Finish". Add the
following class-level annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Provider
@Consumes(MediaType.APPLICATION_JSON)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Provider</code> allows this implementation to be discovered by the JAX-RS
runtime during the provider scanning phase. @Consumes indicates that
this implementation will consume a JSON representation of the resource.</p>
</div>
<div class="paragraph">
<p>Make sure to resolve imports from the appropriate package as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.2-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>7.3</strong> Make the class implements <code>MessageBodyReader&lt;Movie&gt;</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.3-implements.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on the hint (shown as yellow bulb) on the class definition and
select "Implement all abstract methods".</p>
</div>
<div class="paragraph">
<p><strong>7.4</strong> Change implementation of the <code>isReadable</code> method as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">return Movie.class.isAssignableFrom(type);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method ascertains if the <code>MessageBodyReader</code> can produce an instance
of a particular type.</p>
</div>
<div class="paragraph">
<p><strong>7.5</strong> Replace the readFrom method to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Override
public Movie readFrom(
    Class&lt;Movie&gt; type,
    Type type1,
    Annotation[] antns,
    MediaType mt,
    MultivaluedMap&lt;String, String&gt; mm,
    InputStream in)
      throws IOException, WebApplicationException {

    Movie movie = new Movie();
    JsonParser parser = Json.createParser(in);
    while (parser.hasNext()) {
        switch (parser.next()) {
            case KEY_NAME:
                String key = parser.getString();
                parser.next();
                switch (key) {
                    case "id":
                        movie.setId(parser.getInt());
                        break;
                    case "name":
                        movie.setName(parser.getString());
                        break;
                    case "actors":
                        movie.setActors(parser.getString());
                        break;
                    default:
                        break;
                }
                break;
            default:
                break;
        }
    }
    return movie;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code reads a type from the input stream in. <code>JsonParser</code>, a streaming
parser, is created from the input stream. Key values are read from the
parser and a <code>Movie</code> instance is populated and returned.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>7.6</strong> Right-click on newly created package, select "New", "Java Class…",
specify the name as "MovieWriter", and click on "Finish". Add the
following class-level annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Provider
@Produces(MediaType.APPLICATION_JSON)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Provider</code> allows this implementation to be discovered by the JAX-RS
runtime during the provider scanning phase. <code>@Produces</code> indicates that
this implementation will produce a JSON representation of the resource.</p>
</div>
<div class="paragraph">
<p>Resolve the imports as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.6-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>7.7</strong> Make this class implements <code>MessageBodyWriter&lt;Movie&gt;</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.7-implements.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on the hint (show as yellow bulb) on the class definition and
select "Implement all abstract methods".</p>
</div>
<div class="paragraph">
<p><strong>7.8</strong> Change implementation of the <code>isWritable</code> method to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">return Movie.class.isAssignableFrom(type);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method ascertains if the <code>MessageBodyWriter</code> supports a particular
type.</p>
</div>
<div class="paragraph">
<p><strong>7.9</strong> Add implementation of the <code>getSize</code> method as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">return -1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Originally, this method was called to ascertain the length in bytes of
the serialized form of <code>t</code>. In JAX-RS 2.0, this method is deprecated and
the value returned by the method is ignored by a JAX-RS runtime. All
<code>MessageBodyWriter</code> implementations are advised to return -1.</p>
</div>
<div class="paragraph">
<p><strong>7.10</strong> Change implementation of the <code>writeTo</code> method as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public void writeTo(Movie t,
    Class&lt;?&gt; type,
    Type type1,
    Annotation[] antns,
    MediaType mt,
    MultivaluedMap&lt;String, Object&gt; mm,
    OutputStream out)
        throws IOException, WebApplicationException \{

    JsonGenerator gen = Json.createGenerator(out);
    gen.writeStartObject()
        .write("id", t.getId())
        .write("name", t.getName())
        .write("actors", t.getActors())
        .writeEnd();
        gen.flush();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method writes a type to an HTTP message. JsonGenerator writes JSON
data to an output stream in a streaming way. Overloaded write methods
are used to write different data types to the stream.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><strong>7.11</strong> In "Web Pages", right-click on "client" folder, select "New",
"Facelets Template Client".</p>
</div>
<div class="paragraph">
<p>Give the File Name as "addmovie". Click on "Browse…" next to
"Template:", expand "Web Pages", "WEB-INF", select "template.xhtml", and
click on "Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p>Replace the content inside <code>&lt;ui:define&gt;</code> with "content" with the code
fragment shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h1&gt;Add a New Movie&lt;/h1&gt;
&lt;h:form&gt;
    &lt;table cellpadding="5" cellspacing="5"&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Id:&lt;/th&gt;
            &lt;td&gt;&lt;h:inputText value="#{movieBackingBean.movieId}"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Name:&lt;/th&gt;
            &lt;td&gt;&lt;h:inputText value="#{movieBackingBean.movieName}"/&gt; &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;th align="left"&gt;Movie Actors:&lt;/th&gt;
            &lt;td&gt;&lt;h:inputText value="#{movieBackingBean.actors}"/&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;h:commandButton
        value="Add"
        action="movies"
        actionListener="#{movieClientBean.addMovie()}"/&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a form to accept input of <code>id</code>, <code>name</code>, and <code>actors</code> of a
movie. These values are bound to fields in <code>MovieBackingBean</code>. The click
of command button invokes the addMovie method from <code>MovieClientBean</code> and
then renders "movies.xhtml".</p>
</div>
<div class="paragraph">
<p>Click on the hint (show as yellow bulb) to resolve the namespace
prefix/URI mapping as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.11-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>7.12</strong> Add <code>movieName</code> and <code>actors</code> field to <code>MovieBackingBean</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">String movieName;
String actors;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate getters and setters by clicking on the menu item "Source" and
then "Insert Code&#8230;".</p>
</div>
<div class="paragraph">
<p><strong>7.13</strong> Add the following code to "movies.xhtml"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:commandButton value="New Movie" action="addmovie" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>along with rest of the &lt;commandButton&gt;s.</p>
</div>
<div class="paragraph">
<p><strong>7.14</strong> Add the following method in <code>MovieClientBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public void addMovie() {
    Movie m = new Movie();
    m.setId(bean.getMovieId());
    m.setName(bean.getMovieName());
    m.setActors(bean.getActors());
    target
        .register(MovieWriter.class)
        .request()
        .post(Entity.entity(m, MediaType.APPLICATION_JSON));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method creates a new <code>Movie</code> instance, populates it with the values
from the backing bean, and POSTs the bean to the REST endpoint. The
register method registers a MovieWriter that provides conversion from
the POJO to JSON. Media type of "application/json" is specified using
<code>MediaType.APPLICATION_JSON</code>.</p>
</div>
<div class="paragraph">
<p>Resolve the imports as shown</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.14-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>7.15</strong> Run the project to see the updated main page as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.15-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>A new movie can be added by clicking on "New Movie" button.</p>
</div>
<div class="paragraph">
<p><strong>7.16</strong> Enter the details as shown:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.16-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on "Add" button. The "Movie Id" value has to be greater than 20
otherwise the primary key constraint will be violated. The table
definition may be updated to generate the primary key based upon a
sequence; however this is not done in the application.</p>
</div>
<div class="paragraph">
<p>The updated page looks like as shown</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/7.16-output2.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Note that the newly added movie is now displayed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms">8. Movie Points (Java Message Service)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: Customers accrue points for watching a movie.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>Java Message Service 2.0 allows sending and receiving messages between
distributed systems. JMS 2 introduced several improvements over the
previous version such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New <code>JMSContext</code> interface</p>
</li>
<li>
<p>AutoCloseable <code>JMSContext</code>, <code>Connection</code>, and <code>Session</code></p>
</li>
<li>
<p>Use of runtime exceptions</p>
</li>
<li>
<p>Method chaining on <code>JMSProducer</code></p>
</li>
<li>
<p>Simplified message sending</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section will provide a page to simulate submission of movie points
accrued by a customer. These points are submitted to a JMS queue that is
then read synchronously by another bean. JMS queue for further
processing, possibly storing in the database using JPA.</p>
</div>
<div class="paragraph">
<p><strong>8.1</strong> Right-click on Source Packages, select "New", "Java Package…",
specify the value as "org.glassfish.movieplex7.points", and click on
"Finish".</p>
</div>
<div class="paragraph">
<p><strong>8.2</strong> Right-click on newly created package, select "New", "Java Class…",
specify the name as "SendPointsBean".</p>
</div>
<div class="paragraph">
<p>Add the following class-level annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Named
@RequestScoped</code></pre>
</div>
</div>
<div class="paragraph">
<p>This makes the bean to be EL-injectable and automatically activated and
passivated with the request.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.2-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>8.3</strong> A message to a JMS Queue is sent after the customer has bought the
tickets. Another bean will then retrieve this message and update the
points for that customer. This allows the two systems, one generating
the data about tickets purchased and the other about crediting the
account with the points, completely decoupled.</p>
</div>
<div class="paragraph">
<p>This lab will mimic the sending and consuming of a message by an
explicit call to the bean from a JSF page.</p>
</div>
<div class="paragraph">
<p>Add the following field to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@NotNull
@Pattern(regexp = "^\\d\{2},\\d\{2}",
         message = "Message format must be 2 digits, comma, 2 digits, e.g.12,12")
private String message;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This field contains the message sent to the queue. This field’s value is
bound to an inputText in a JSF page (created later). Constraints have
been specified on this bean that enable validation of data on form
submit. It requires the data to consists of 2 numerical digits, followed
by a comma, and then 2 more numerical digits. If the message does not
meet the validation criteria then the error message to be displayed is
specified using message attribute.</p>
</div>
<div class="paragraph">
<p>This could be thought as conveying the customer identifier and the
points accrued by that customer.</p>
</div>
<div class="paragraph">
<p>Generate getter/setters for this field. Right-click in the editor pane,
select "Insert Code" (Ctrl + I shortcut on Mac), select "Getter and
Setter…", select the field, and click on "Generate".</p>
</div>
<div class="paragraph">
<p><strong>8.4</strong> Add the following code to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Inject
JMSContext context;

@Resource(lookup = "java:global/jms/pointsQueue")
Queue pointsQueue;

public void sendMessage() \{
    System.out.println("Sending message: " + message);
    context.createProducer().send(pointsQueue, message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java EE Platform requires a pre-configured JMS connection factory
under the JNDI name <code>java:comp/DefaultJMSConnectionFactory</code>. If no
connection factory is specified then the pre-configured connection
factory is used. In a Java EE environment, where CDI is enabled by
default anyway, a container-managed JMSContext can be injected as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Inject
JMSContext context;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code uses the default factory to inject an instance of
container-managed JMSContext.</p>
</div>
<div class="paragraph">
<p><code>JMSContext</code> is a new interface introduced in JMS 2. This combines in a
single object the functionality of two separate objects from the JMS 1.1
API: a <code>Connection</code> and a <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>When an application needs to send messages it use the <code>createProducer</code>
method to create a <code>JMSProducer</code> that provides methods to configure and
send messages. Messages may be sent either synchronously or
asynchronously.</p>
</div>
<div class="paragraph">
<p>When an application needs to receive messages it uses one of several
<code>createConsumer</code> or <code>createDurableConsumer</code> methods to create a <code>JMSConsumer</code>.
A <code>JMSConsumer</code> provides methods to receive messages either synchronously
or asynchronously.</p>
</div>
<div class="paragraph">
<p>All messages are then sent to a <code>Queue</code> instance (created later)
identified by <code>java:global/jms/pointsQueue</code> JNDI name. The actual message
is obtained from the value entered in the JSF page and bound to the
message field.</p>
</div>
<div class="paragraph">
<p>Resolve the imports.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure <code>Queue</code> class is imported from <code>javax.jms.Queue</code> instead of the
default <code>java.util.Queue</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Click on "OK".</p>
</div>
<div class="paragraph">
<p><strong>8.5</strong> Right-click on "org.glassfish.movieplex7.points" package, select
"New", "Java Class…", specify the name as "ReceivePointsBean".</p>
</div>
<div class="paragraph">
<p>Add the following class-level annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@JMSDestinationDefinition(name = "java:global/jms/pointsQueue",
interfaceName = "javax.jms.Queue")
@Named
@RequestScoped</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows the bean to refered from an EL expression. It also activates
and passivates the bean with the request.</p>
</div>
<div class="paragraph">
<p><code>JMSDestinationDefinition</code> is a new annotation introduced in JMS 2. It is
used by the application to provision the required resources and allow an
application to be deployed into a Java EE environment with minimal
administrative configuration. This code will create Queue with the JNDI
name <code>java:global/jms/pointsQueue</code>.</p>
</div>
<div class="paragraph">
<p><strong>8.6</strong> Add the following code to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Inject
JMSContext context;

@Resource(lookup="java:global/jms/pointsQueue")
Queue pointsQueue;

public String receiveMessage() {
    String message = context.createConsumer(pointsQueue).receiveBody(String.class);
    System.out.println("Received message: " + message);
    return message;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is very similar to <code>SendPointsBean</code>. The <code>createConsumer</code> method
creates <code>JMSConsumer</code> which is then used to synchronously receive a
message.</p>
</div>
<div class="paragraph">
<p><strong>8.7</strong> Add the following method to the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public int getQueueSize() {
    int count = 0;
    try {
        QueueBrowser browser = context.createBrowser(pointsQueue);
        Enumeration elems = browser.getEnumeration();
        while (elems.hasMoreElements()) {
            elems.nextElement();
            count++;
        }
    } catch (JMSException ex) {
        ex.printStackTrace();
    }
    return count;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a <code>QueueBrowser</code> to look at the messages on a queue
without removing them. It calculates and returns the total number of
messages in the queue.</p>
</div>
<div class="paragraph">
<p>Make sure to resolve the import from <code>javax.jms.Queue</code>, take all other
defaults.</p>
</div>
<div class="paragraph">
<p><strong>8.8</strong> Right-click on "Web Pages", select "New", "Folder…", specify the
name as "points", and click on "Finish".</p>
</div>
<div class="paragraph">
<p>In "Web Pages", right-click on newly created folder, select "Facelets
Template Client", give the File Name as "points". Click on "Browse…"
next to "Template:", expand "Web Pages", "WEB-INF", select
"template.xhtml", and click on "Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p>Replace the content inside <code>&lt;ui:define&gt;</code> with "content" with the code
fragment shown below:</p>
</div>
<div class="paragraph">
<p>Copy the following code inside <code>&lt;ui:define&gt;</code> with name="content":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h1&gt;Points&lt;/h1&gt;
&lt;h:form&gt;
Queue size:
    &lt;h:outputText value="#{receivePointsBean.queueSize}"/&gt;&lt;p/&gt;
    &lt;h:inputText value="#{sendPointsBean.message}"/&gt;
    &lt;h:commandButton
        value="Send Message"
        action="points"
        actionListener="#{sendPointsBean.sendMessage()}"/&gt;
&lt;/h:form&gt;
&lt;h:form&gt;
    &lt;h:commandButton
        value="Receive Message"
        action="points"
        actionListener="#{receivePointsBean.receiveMessage()}"/&gt;
&lt;/h:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click on the yellow bulb to resolve namespace prefix/URI mapping for <code>h:</code>
prefix.</p>
</div>
<div class="paragraph">
<p>This page displays the number of messages in the current queue. It
provides a text box for entering the message that can be sent to the
queue. The first command button invokes <code>sendMessage</code> method from
<code>SendPointsBean</code> and refreshes the page. Updated queue count, incremented
by 1 in this case, is displayed. The second command button invokes
<code>receiveMessage</code> method from <code>ReceivePointsBean</code> and refreshes the page. The
queue count is updated again, decremented by 1 in this case.</p>
</div>
<div class="paragraph">
<p>If the message does not meet the validation criteria then the error
message is displayed on the screen.</p>
</div>
<div class="paragraph">
<p><strong>8.9</strong> Add the following code in "template.xhtml" along with other
`&lt;outputLink&gt;`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;p/&gt;&lt;h:outputLink
        value="${facesContext.externalContext.requestContextPath}/faces/points/points.xhtml"&gt;
        Points
    &lt;/h:outputLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>8.10</strong> Run the project. The update page looks like as shown:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on "Points" to see the output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output2.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The output shows that the queue has 0 messages. Enter a message "1212"
in the text box and click on "Send Message" to see the output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output3.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>This message is not meeting the validation criteria and so the error
message is displayed.</p>
</div>
<div class="paragraph">
<p>Enter a message as "12,12" in the text box and click on "Send Message"
button to see the output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output4.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The updated count now shows that there is 1 message in the queue. Click
on "Receive Message" button to see output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output5.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The updated count now shows that the message has been consumed and the
queue has 0 messages.</p>
</div>
<div class="paragraph">
<p>Click on "Send Message" 4 times to see the output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output6.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The updated count now shows that the queue has 4 messages. Click on
"Receive Message" 2 times to see the output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/8.10-output7.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The count is once again updated to reflect the 2 consumed and 2
remaining messages in the queue.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsf">9. Show Booking (JavaServer Faces)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Purpose</strong>: Build pages that allow a user to book a particular movie show
in a theater. In doing so a new feature of JavaServer Faces 2.2 will be
introduced and demonstrated by using in the application.</p>
</div>
<div class="paragraph">
<p><strong>Estimated Time</strong>: 30-45 mins</p>
</div>
<div class="paragraph">
<p>JavaServer Faces 2.2 introduces a new feature called <em>Faces Flow</em> that
provides an encapsulation of related views/pages with application
defined entry and exit points. Faces Flow borrows core concepts from ADF
TaskFlow, Spring Web Flow, and Apache MyFaces CODI.</p>
</div>
<div class="paragraph">
<p>It introduces <code>@FlowScoped</code> CDI annotation for flow-local storage and
<code>@FlowDefinition</code> to define the flow using CDI producer methods. There are
clearly defined entry and exit points with well-defined parameters. This
allows the flow to be packaged together as a JAR or ZIP file and be
reused. The application thus becomes a collection of flows and non-flow
pages. Usually the objects in a flow are designed to allow the user to
accomplish a task that requires input over a number of different views.</p>
</div>
<div class="paragraph">
<p>This application will build a flow that allows the user to make a movie
reservation. The flow will contain four pages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Display the list of movies</p>
</li>
<li>
<p>Display the list of available show timings</p>
</li>
<li>
<p>Confirm the choices</p>
</li>
<li>
<p>Make the reservation and show the ticket</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>9.1</strong> Items in a flow are logically related to each other and so it is
required to keep them together in a directory. In NetBeans, right-click
on the "Web Pages", select "New", "Folder…", specify the folder name
"booking", and click on "Finish".</p>
</div>
<div class="paragraph">
<p><strong>9.2</strong> Right-click on the newly created folder, select "New", "Facelets
Template Client", give the File Name as "booking". Click on "Browse…"
next to "Template:", expand "Web Pages", "WEB-INF", select
"template.xhtml", and click on "Select File". Click on "Finish".</p>
</div>
<div class="paragraph">
<p>In this file, remove <code>&lt;ui:define&gt;</code> sections where name attribute value is
"top" and "left". These sections are inherited from the template.</p>
</div>
<div class="paragraph">
<p><strong>9.3</strong> "booking.xhtml" is the entry point to the flow (more on this
later). Replace the <code>&lt;ui:define&gt;</code> with name="content" section such that it
looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;h2&gt;Pick a movie&lt;/h2&gt;
    &lt;h:form prependId="false"&gt;
        &lt;h:selectOneRadio
            value="#{booking.movieId}"
            layout="pageDirection"
            required="true"&gt;
            &lt;f:selectItems
                value="#{movieFacadeREST.all}"
                var="m"
                itemValue="#{m.id}"
                itemLabel="#{m.name}"/&gt;
        &lt;/h:selectOneRadio&gt;
        &lt;h:commandButton id="shows" value="Pick a time" action="showtimes" /&gt;
    &lt;/h:form&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code builds an HTML form that displays the list of movies as radio
button choices. The chosen movie is bound to #{booking.movieId} which
will be defined as a flow-scoped bean. The value of action attribute on
commandButton refers to the next view in the flow, i.e.
"showtimes.xhtml" in the same directory in our case.</p>
</div>
<div class="paragraph">
<p>Click on the hint (shown as yellow bulb) and click on the suggestion to
add namespace prefix. Do the same for f: prefix as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.3-imports.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p><strong>9.4</strong> Right-click on "Source Packages", select "New", "Java Class…".
Specify the class name as "Booking" and the package name as
"org.glassfish.movieplex7.booking".</p>
</div>
<div class="paragraph">
<p>Add <code>@Named</code> class-level annotation to make the class EL-injectable. Add
<code>@FlowScoped("booking")</code> to define the scope of bean as the flow. The bean
is automatically activated and passivated as the flow is entered or
exited.</p>
</div>
<div class="paragraph">
<p>Add the following field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">int movieId;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and generate getters/setters by going to "Source", "Insert Code…",
selecting "Getter and Setter…", and select the field.</p>
</div>
<div class="paragraph">
<p>Inject <code>EntityManager</code> in this class by adding the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@PersistenceContext
EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following convenience method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public String getMovieName() {
    try {
        return em.createNamedQuery("Movie.findById", Movie.class)
                  .setParameter("id", movieId)
                  .getSingleResult()
                  .getName();
    } catch (NoResultException e) {
        return "";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will return the movie name based upon the selected movie.</p>
</div>
<div class="paragraph">
<p>Alternatively, movie id and name may be passed from the selected radio
button and parsed in the backing bean. This will reduce an extra trip to
the database.</p>
</div>
<div class="paragraph">
<p><strong>9.5</strong> Create "showtimes.xhtml" in the "booking" folder following the
steps in section 9.2. Replace "content" <code>&lt;ui:define&gt;</code> section such that it
looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;h2&gt;Show Timings for &lt;font color="red"&gt;#{booking.movieName}&lt;/font&gt;&lt;/h2&gt;
    &lt;h:form&gt;
        &lt;h:selectOneRadio value="#{booking.startTime}" layout="pageDirection" required="true"&gt;
            &lt;c:forEach items="#{timeslotFacadeREST.all}" var="s"&gt;
                &lt;f:selectItem itemValue="#{s.id},#{s.startTime}" itemLabel="#{s.startTime}"/&gt;
            &lt;/c:forEach&gt;
        &lt;/h:selectOneRadio&gt;
        &lt;h:commandButton value="Confirm" action="confirm" /&gt;
        &lt;h:commandButton id="back" value="Back" action="booking" immediate="true"/&gt;
    &lt;/h:form&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code builds an HTML form that displays the chosen movie name and
all the show times. <code>#{timeslotFacadeREST.all}</code> returns the list of all
the movies and iterates over them using a <code>c:forEach</code> loop. The id and
start time of the selected show are bound to <code>#{booking.startTime}</code>. One
command button (value="Back") allows going back to the previous page and
the other command button (value="Confirm") takes to next view in the
flow, "confirm.xhtml" in our case.</p>
</div>
<div class="paragraph">
<p>Typically a user will expect the show times only for the selected movie
but all the show times are shown here. This allows us to demonstrate
going back and forth within a flow if an incorrect show time for a movie
is chosen. A different query may be written that displays only the shows
available for this movie; however this is not part of the application.</p>
</div>
<div class="paragraph">
<p><strong>9.6</strong> Add the following fields to the Booking class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">String startTime;
int startTimeId;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public String getStartTime() {
    return startTime;
}

public void setStartTime(String startTime) {
    StringTokenizer tokens = new StringTokenizer(startTime, ",");
    startTimeId = Integer.parseInt(tokens.nextToken());
    this.startTime = tokens.nextToken();
}

public int getStartTimeId() {
    return startTimeId;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These methods will parse the values received from the form. Also add the
following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public String getTheater() {
    // for a movie and show
    try {

        // Always return the first theater
        List&lt;ShowTiming&gt; list =
            em.createNamedQuery("ShowTiming.findByMovieAndTimingId",
                ShowTiming.class)
                .setParameter("movieId", movieId)
                .setParameter("timingId", startTimeId)
                .getResultList();

        if (list.isEmpty())
            return "none";

        return list
                .get(0)
                .getTheaterId()
                .getId()
                .toString();
    } catch (NoResultException e) {
        return "none";
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will find the first theater available for the chosen movie
and show the timing.</p>
</div>
<div class="paragraph">
<p>Additionally a list of theaters offering that movie may be shown in a
separate page.</p>
</div>
<div class="paragraph">
<p><strong>9.7</strong> Create "confirm.xhtml" page in the "booking" folder by following
the steps defined in 9.2. Replace "content" <code>&lt;ui:define&gt;</code> section such
that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;c:choose&gt;
        &lt;c:when test="#{booking.theater == 'none'}"&gt;
            &lt;h2&gt;No theater found, choose a different time&lt;/h2&gt;
            &lt;h:form&gt;
                Movie name: #{booking.movieName}&lt;p/&gt;
                Starts at: #{booking.startTime}&lt;p/&gt;
                &lt;h:commandButton id="back" value="Back" action="showtimes"/&gt;
            &lt;/h:form&gt;
        &lt;/c:when&gt;
        &lt;c:otherwise&gt;
            &lt;h2&gt;Confirm ?&lt;/h2&gt;
            &lt;h:form&gt;
                Movie name: #{booking.movieName}&lt;p/&gt;
                Starts at: #{booking.startTime}&lt;p/&gt;
                Theater: #{booking.theater}&lt;p/&gt;
                &lt;h:commandButton id="next" value="Book" action="print"/&gt;
                &lt;h:commandButton id="back" value="Back" action="showtimes"/&gt;
            &lt;/h:form&gt;
        &lt;/c:otherwise&gt;
    &lt;/c:choose&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code displays the selected movie, show timing, and theater if
available. The reservation can proceed if all three are available.
"print.xhtml", identified by action of commandButton with "Book" value,
is the last page that shows the confirmed reservation.</p>
</div>
<div class="paragraph">
<p><code>actionListener</code> can be added to <code>commandButton</code> to invoke the business
logic for making the reservation. Additional pages may be added to take
the credit card details and email address.</p>
</div>
<div class="paragraph">
<p><strong>9.8</strong> Create "print.xhtml" page in the "booking" folder by following the
steps defined in 9.2 and replace "content" <code>&lt;ui:define&gt;</code> section such that
it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;ui:define name="content"&gt;
    &lt;h2&gt;Reservation Confirmed&lt;/h2&gt;
    &lt;h:form&gt;
        Movie name: #{booking.movieName}&lt;p/&gt;
        Starts at: #{booking.startTime}&lt;p/&gt;
        Theater: #{booking.theater}&lt;p/&gt;
        &lt;h:commandButton id="home" value="home" action="goHome" /&gt;&lt;/p&gt;
    &lt;/h:form&gt;
&lt;/ui:define&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code displays the movie name, show timings, and the selected
theater.</p>
</div>
<div class="paragraph">
<p>The <code>commandButton</code> initiates exit from the flow. The <code>action</code> attribute
defines a navigation rule that will be defined in the next step.</p>
</div>
<div class="paragraph">
<p><strong>9.9</strong> "booking.xhtml", "showtimes.xhtml", "confirm.xhtml", and
"print.xhtml" are all in the same directory. Now the runtime needs to be
informed that the views in this directory are to be treated as view
nodes in a flow. This can be done by adding "booking/booking-flow.xml"
or have a class with a method that <code>@Produces @FlowDefinition</code>.</p>
</div>
<div class="paragraph">
<p>Right-click on "Web Pages/booking" folder, select "New", "Other", "XML",
"XML Document", give the name as "booking-flow", click on "Next&gt;", take
the default of "Well-formed Document", and click on "Finish". Edit the
file such that it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;faces-config
    version="2.2"
    xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
        http://xmlns.jcp.org/xml/ns/javaee/web-facesconfig_2_2.xsd"&gt;
    &lt;flow-definition id="booking"&gt;
        &lt;flow-return id="goHome"&gt;
        &lt;from-outcome&gt;/index&lt;/from-outcome&gt;
        &lt;/flow-return&gt;
    &lt;/flow-definition&gt;
&lt;/faces-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines the flow graph. It uses the standard parent element used in
any "faces-config.xml" but defines a <code>&lt;flow-definition&gt;</code>.</p>
</div>
<div class="paragraph">
<p><code>&lt;flow-return&gt;</code> defines a return node in a flow graph. <code>&lt;from-outcome&gt;</code>
contains the node value, or an EL expression that defines the node, to
return to. In this case, the navigation returns to the home page.</p>
</div>
<div class="paragraph">
<p><strong>9.10</strong> Finally, invoke the flow by editing "WEB-INF/template.xhtml" and
changing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:commandLink action="item1"&gt;Item 1&lt;/h:commandLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;h:commandLink action="booking"&gt;Book a movie&lt;/h:commandLink&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>commandLink</code> renders an HTML anchor tag that behaves like a form submit
button. The action attribute points to the directory where all views for
the flow are stored. This directory already contains "booking-flow.xml"
which defines the flow of the pages.</p>
</div>
<div class="paragraph">
<p><strong>9.11</strong> Run the project by right clicking on the project and selecting
"Run". The browser shows the updated output.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.11-output.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on "Book a movie" to see the page as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.11-output2.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Select a movie, say "The Shining" and click on "Pick a time" to see the
page output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.11-output3.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Pick a time slot, say "04:00", click
on "Confirm" to see the output as shown.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.11-output4.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Click on "Book" to confirm and see the output as:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/9.11-output5.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Feel free to enter other combinations, go back and forth in the flow and
notice how the values in the bean are preserved.</p>
</div>
<div class="paragraph">
<p>Click on "home" takes to the main application page.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">10. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hands-on lab built a trivial 3-tier web application using Java EE 7
and demonstrated the following features of the platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java EE 7 Platform (JSR 342)</p>
<div class="ulist">
<ul>
<li>
<p>Maven coordinates</p>
</li>
<li>
<p>Default DataSource</p>
</li>
<li>
<p>Default JMSConnectionFactory</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java Persistence API 2.1 (JSR 338)</p>
<div class="ulist">
<ul>
<li>
<p>Schema generation properties</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java API for RESTful Web Services 2.0 (JSR 339)</p>
<div class="ulist">
<ul>
<li>
<p>Client API</p>
</li>
<li>
<p>Custom Entity Providers</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java Message Service 2.0 (JSR 343)</p>
<div class="ulist">
<ul>
<li>
<p>Default ConnectionFactory</p>
</li>
<li>
<p>Injecting JMSContext</p>
</li>
<li>
<p>Synchronous message send and receive</p>
</li>
</ul>
</div>
</li>
<li>
<p>JavaServer Faces 2.2 (JSR 344)</p>
<div class="ulist">
<ul>
<li>
<p>Faces Flow</p>
</li>
</ul>
</div>
</li>
<li>
<p>Contexts and Dependency Injection 1.1 (JSR 346)</p>
<div class="ulist">
<ul>
<li>
<p>Automatic discovery of beans</p>
</li>
<li>
<p>Injection of beans</p>
</li>
</ul>
</div>
</li>
<li>
<p>Bean Validation 1.1 (JSR 349)</p>
<div class="ulist">
<ul>
<li>
<p>Integration with JavaServer Faces</p>
</li>
</ul>
</div>
</li>
<li>
<p>Batch Applications for the Java Platform 1.0 (JSR 352)</p>
<div class="ulist">
<ul>
<li>
<p>Chunk-style processing</p>
</li>
<li>
<p>Exception handling</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java API for JSON Processing 1.0 (JSR 353)</p>
<div class="ulist">
<ul>
<li>
<p>Streaming API for generating JSON</p>
</li>
<li>
<p>Streaming API for consuming JSON</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java API for WebSocket 1.0 (JSR 356)</p>
<div class="ulist">
<ul>
<li>
<p>Annotated server endpoint</p>
</li>
<li>
<p>JavaScript client</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java Transaction API 1.2 (JSR 907)</p>
<div class="ulist">
<ul>
<li>
<p>@Transactional</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hopefully this has raised your interest enough in trying out Java EE 7 applications using GlassFish 4.</p>
</div>
<div class="paragraph">
<p>Send us feedback at <a href="mailto:users@glassfish.java.net">users@glassfish.java.net</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">11. Troubleshooting</h2>
<div class="sectionbody">
<div class="qlist qanda">
<ol>
<li>
<p><em>How can I start/stop/restart GlassFish from within the IDE ?</em></p>
<p>In the "Services" tab, right-click on "GlassFish Server 4". All the
commands to start, stop, and restart are available from the pop-up menu.</p>
</li>
<li>
<p><em>I accidentally closed the GlassFish output log window. How do I bring it back ?</em></p>
<p>In “Services” tab of NetBeans, expand "Servers", choose the GlassFish
node, and select "View Domain Server Log".
<span class="image"><img src="images/netbeans-view-log.png" alt="image"></span>
In addition the web-based administration
console can be seen by clicking on "View Domain Admin Console".</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">12. Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following Java EE community members graciously reviewed this hands-on lab:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Antonio Goncalves (@agoncal)</p>
</li>
<li>
<p>Markus Eisele (@myfear)</p>
</li>
<li>
<p>Craig Sharpe (@dapugs)</p>
</li>
<li>
<p>Marcus Vinicius Margarites (@mvfm)</p>
</li>
<li>
<p>David Delabasse (@delabasse)</p>
</li>
<li>
<p>John Clingan (@jclingan)</p>
</li>
<li>
<p>Reza Rahman (@reza_rahman)</p>
</li>
<li>
<p>Marian Muller (@mullermarian)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thank you very much for providing the valuable feedback!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_completed_solutions">13. Completed Solutions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The completed solution can be downloaded from <a href="https://github.com/javaee-samples/javaee7-hol/blob/master/solution/movieplex7-solution.zip">javaee7-hol</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo">14. TODO</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following use cases:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Concurrency Utilities for Java EE</p>
</li>
<li>
<p>WebSocket Java Client</p>
</li>
</ol>
</div>
</li>
<li>
<p>Disable errors in persistence.xml</p>
</li>
<li>
<p>How to override .m2/repository in NetBeans?</p>
</li>
<li>
<p>Add icons for Fix Imports, Format, Fix namespaces, Run the Project.</p>
</li>
<li>
<p>Change logging to use java.util.Logging.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history">15. Revision History</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Moving the source document from Pages to AsciiDoc (Dec 3, 2013)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix">16. Appendix A: Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="appendix-glassfish4-netbeans">16.1. Configure GlassFish 4 in NetBeans IDE</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In NetBeans, click on the “Services” tab.</p>
</li>
<li>
<p>Right-click on Servers, choose “Add Server&#8230;” in the pop-up menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/netbeans-addserver.png" alt="image"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select "GlassFish Server" in the Add Server Instance wizard, set the
name to "GlassFish 4.0" and click "Next &gt;".</p>
</li>
<li>
<p>Click on "Browse …" and browse to where you unzipped the GlassFish
build and point to the "glassfish4" directory that got created when you
unzipped the above archive. Click on "Finish".</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.0<br>
Last updated 2013-12-04 16:32:52 PST
</div>
</div>
</body>
</html>